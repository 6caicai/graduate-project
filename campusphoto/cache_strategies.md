# Redis 缓存策略对比实验 - 六种策略设计

## 策略1: 无缓存基准测试 (Baseline)
**目标**: 建立性能基准，测量无缓存时的系统性能
**实现**: 直接查询数据库，不使用任何缓存
**适用场景**: 作为对比基准

## 策略2: Cache-Aside 基础模式
**目标**: 实现基本的读写缓存策略
**实现**: 
- 读操作: 先查缓存，未命中则查DB并写入缓存
- 写操作: 先更新DB，再删除缓存
**Key设计**: 
- `photo:detail:{photo_id}` - 照片详情 (TTL: 300s)
- `photo:list:{page}:{size}` - 照片列表 (TTL: 180s)
**TTL策略**: 固定过期时间

## 策略3: Cache-Aside + 智能TTL
**目标**: 基于数据热度动态调整TTL
**实现**: 
- 热门数据: TTL = 600s
- 普通数据: TTL = 300s  
- 冷门数据: TTL = 60s
**热度判断**: 基于访问频率和点赞数
**Key设计**: 
- `photo:detail:{photo_id}` - 照片详情 (动态TTL)
- `photo:hot:{photo_id}` - 热度标记 (TTL: 3600s)

## 策略4: Write-Through 模式
**目标**: 写操作同时更新缓存和数据库
**实现**: 
- 读操作: 优先从缓存读取
- 写操作: 同时写入缓存和DB
**适用场景**: 数据一致性要求高的场景
**Key设计**: 
- `photo:detail:{photo_id}` - 照片详情 (TTL: 600s)
- `photo:stats:{photo_id}` - 统计数据 (TTL: 300s)

## 策略5: Write-Behind 异步模式
**目标**: 写操作异步更新数据库，提高写入性能
**实现**: 
- 读操作: 从缓存读取
- 写操作: 立即更新缓存，异步更新DB
**风险控制**: 队列大小限制，失败重试机制
**Key设计**: 
- `photo:detail:{photo_id}` - 照片详情 (TTL: 1800s)
- `photo:queue:{timestamp}` - 异步队列

## 策略6: 混合策略 (最优组合)
**目标**: 结合多种策略的优势
**实现**: 
- 照片详情: Cache-Aside + 智能TTL
- 排行榜: Write-Through + 定期刷新
- 统计数据: Write-Behind + 批量更新
**Key设计**: 
- `photo:detail:{photo_id}` - 照片详情 (智能TTL)
- `ranking:photos:{period}` - 照片排行榜 (TTL: 120s)
- `ranking:photographers:{period}` - 摄影师排行榜 (TTL: 120s)
- `stats:user:{user_id}` - 用户统计 (TTL: 600s)

## 实验指标对比
| 策略 | 平均延迟 | P95延迟 | 命中率 | 内存占用 | 数据一致性 | 复杂度 |
|------|----------|---------|--------|----------|------------|--------|
| 1. 无缓存 | 基准 | 基准 | 0% | 0MB | 100% | 低 |
| 2. Cache-Aside | 目标-50% | 目标-40% | 80%+ | <500MB | 95% | 中 |
| 3. 智能TTL | 目标-60% | 目标-50% | 85%+ | <600MB | 95% | 中高 |
| 4. Write-Through | 目标-45% | 目标-35% | 90%+ | <700MB | 99% | 高 |
| 5. Write-Behind | 目标-70% | 目标-60% | 80%+ | <800MB | 90% | 高 |
| 6. 混合策略 | 目标-65% | 目标-55% | 88%+ | <750MB | 97% | 最高 |

## 实验执行顺序
1. 策略1: 无缓存基准测试
2. 策略2: Cache-Aside 基础模式
3. 策略3: Cache-Aside + 智能TTL
4. 策略4: Write-Through 模式
5. 策略5: Write-Behind 异步模式
6. 策略6: 混合策略

每个策略测试时间: 30分钟持续压力测试
测试压力: 50-100 RPS
